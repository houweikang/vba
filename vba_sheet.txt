Function sht_initial(sht_name$, Optional ByVal clean As Boolean = True, Optional ByVal grid_line As Boolean = True)  '检测是否存在表，不存在新建；是否清空（是）；是否清除网格线（否）
If TypeName(Application.Evaluate(sht_name & "!A1")) = "Error" Then
    Worksheets.Add(after:=Sheets(Sheets.Count)).Name = sht_name
Else
    If clean = True Then Sheets(sht_name).Cells.Clear
End If
If Not grid_line Then
    Sheets(sht_name).Activate
    ActiveWindow.DisplayGridlines = False
End If
End Function


Function Mat(ColName$, rg As Range) As Integer '字段名所处列数
Dim rng As Range
For Each rng In rg
    Mat = Mat + 1
    If rng = ColName Then Exit Function
Next
Mat = 0
End Function


Function fun_MergeRanges(ranges As Range)
Dim i&, j&
Application.DisplayAlerts = False
With ranges
For i = .Rows.Count To 1 Step -1
            For j = 1 To .Columns.Count
                If j = 1 Then
                    If .Cells(i, j).Value = .Cells(i - 1, j).Value Then
                            .Cells(i - 1, j).Resize(2, 1).Merge
                    End If
                Else
                    If .Cells(i, j).Value = .Cells(i - 1, j).Value And .Cells(i, j - 1).MergeCells = True Then
                            .Cells(i - 1, j).Resize(2, 1).Merge
                    End If
                End If
            Next
Next
End With
Application.DisplayAlerts = True
End Function

Function one_data(rg As Range) '去重
rg.RemoveDuplicates 1
End Function

function saveas_report()
Dim mypath$, Curday$
Curday = Sheets(1).Cells(2, Columns.Count).End(xlToLeft).Value

Curday = Split(Curday, " ")(0)
With Application.FileDialog(msoFileDialogFolderPicker)
     .InitialFileName = "e:\报表\推广业绩统计晨报or晚报\"
     If .Show = False Then Exit Sub
     mypath = .SelectedItems(1) & "\"
End With         '把文件路径定义给变量
ThisWorkbook.Save
Application.DisplayAlerts = False
Sheets.Copy
ActiveWorkbook.SaveAs mypath & "推广业绩统计晨(晚)报" & Format(Curday, "yyyymmdd") & ".xlsx", FileFormat:=xlOpenXMLWorkbook, CreateBackup:=False
ActiveWorkbook.Close True
Application.DisplayAlerts = True
End Sub